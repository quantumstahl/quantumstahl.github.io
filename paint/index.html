<!doctype html>
<html lang="sv">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
<title>Button Latency Lab</title>
<style>
:root { --bg:#0b0b0e; --fg:#e9eef2; --muted:#9aa6b2; --accent:#5dd4ff; }
html,body{margin:0;height:100%;background:var(--bg);color:var(--fg);font:14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, sans-serif}
.wrap{max-width:900px;margin:auto;padding:16px;}
h1{font-size:20px;margin:0 0 8px}
.desc{color:var(--muted);margin-bottom:12px}
.row{display:flex;gap:12px;flex-wrap:wrap}
.col{flex:1 1 260px;min-width:260px}
.panel{background:#12141a;border:1px solid #1f2430;border-radius:14px;padding:12px;box-shadow:0 4px 20px rgba(0,0,0,.3)}
.btn{display:block;width:100%;padding:18px 16px;border-radius:14px;background:#1a2130;border:1px solid #2a3444;color:var(--fg);text-align:center;font-weight:700;letter-spacing:.2px;cursor:pointer;user-select:none;outline:none;transition:transform .06s ease, opacity .06s ease; will-change: transform, opacity; -webkit-tap-highlight-color: transparent;}
.btn:active{transform:scale(.97);opacity:.95}
.btn.active{box-shadow:0 0 0 2px var(--accent) inset}
.btn small{display:block;font-weight:400;color:var(--muted)}
.k{color:#bcd}
.controls label{display:flex;align-items:center;gap:8px;margin:6px 0}
.stat{display:grid;grid-template-columns:1fr auto;gap:6px;margin:6px 0;color:#d5dde6}
.stat b{color:#fff}
pre.log{height:220px;overflow:auto;background:#0e1116;border:1px solid #1f2430;padding:10px;border-radius:10px;font:12px/1.4 ui-monospace, SFMono-Regular, Menlo, Consolas, monospace}
code{background:#0e1116;padding:2px 6px;border-radius:6px;border:1px solid #1f2430}
.note{color:#b9c3cf}
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
.grid .panel{min-height:140px}
.toggle{accent-color:#5dd4ff}
.muted{color:var(--muted)}
.pill{display:inline-flex;gap:8px;align-items:center;background:#0e1116;border:1px solid #1f2430;padding:6px 10px;border-radius:999px}
</style>
</head>
<body>
<div class="wrap">
<h1>Button Latency Lab</h1>
<div class="desc">Mät hur snabbt knappar reagerar på mobil. Testa <span class="pill"><span>Pointer</span><span class="muted">vs</span><span>Click</span></span>, <code>touch-action</code>, och tungt jobb.</div>


<div class="row">
<div class="col">
<div class="panel controls">
<div class="stat"><span>Aktiv variabel</span><b id="varVal">false</b></div>
<div class="stat"><span>Senaste latency (ms)</span><b id="latency">–</b></div>
<div class="stat"><span>Event path</span><b id="evpath">–</b></div>
<hr style="border-color:#1f2430;border-width:1px 0 0;margin:8px 0">
<label><input id="optManip" class="toggle" type="checkbox" checked> <span><code>touch-action: manipulation</code> på knappar</span></label>
<label><input id="optAddClick" class="toggle" type="checkbox"> <span>Aktivera <code>onclick</code> också (visar ev. dubbeltrigg)</span></label>
<label><input id="optHeavy" class="toggle" type="checkbox"> <span>Simulera tungt jobb på <code>pointerup</code> (200ms)</span></label>
<label><input id="optRAF" class="toggle" type="checkbox" checked> <span>Utför handling i <code>requestAnimationFrame</code></span></label>
<label><input id="optPrevent" class="toggle" type="checkbox" checked> <span><code>preventDefault()</code> på <code>pointerup</code></span></label>
</div>
</div>
<div class="col">
<div class="panel">
<button id="btnPointer" class="btn" type="button">
PointerButton
<small>pointerdown → visuell feedback, pointerup → byt variabel</small>
</button>
</div>
<div class="panel">
<button id="btnClick" class="btn" type="button">
ClickButton
<small>enbart onclick (för jämförelse)</small>
</button>
</div>
</div>
<div class="col">
<div class="panel">
<button id="btnMixed" class="btn" type="button">
MixedButton
<small>pointer + click på samma knapp (medveten fälla)</small>
</button>
</div>
<div class="panel">
<pre class="log" id="log"></pre>
</div>
</div>
</div>


<p class="note">Tips: Tryck snabbt flera gånger på varje knapp på mobilen. Titta på skillnader i latency och om <em>MixedButton</em> ibland dubbelfirar.</p>
</div>


<script>
(() => {
const $ = (sel) => document.querySelector(sel);
const logEl = $('#log');
const outVar = $('#varVal');
const outLat = $('#latency');
const outPath = $('#evpath');
const optManip = $('#optManip');
const optAddClick = $('#optAddClick');
const optHeavy = $('#optHeavy');
const optRAF = $('#optRAF');
const optPrevent = $('#optPrevent');


let stateVar = false;
let tDown = 0;


function setManipulation(on){
document.querySelectorAll('.btn').forEach(b=>{
b.style.touchAction = on ? 'manipulation' : 'auto';
});
}


function heavyWork(ms=200){
const start = performance.now();
</script>
</body>
</html>